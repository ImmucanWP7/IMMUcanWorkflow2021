mount_path <- "/Volumes/G_DQBM_BB_Central$/projects/immucan"
}
library(SingleCellExperiment)
library(caret)
library(doParallel)
library(tidyverse)
library(ggplot2)
sce <- readRDS("O:/projects/immucan/processed_data/Panel_1/classification/raw/data/sce_labelled_V1.rds")
sce_new <- readRDS("O:/projects/immucan/processed_data/Panel_1/classification/raw/data/sce_labelled_V3.rds")
ggplot(data.frame(CD11c = assay(sce[,sce$cell_labels == "DC"], "exprs")["CD11c",],
CD68 = assay(sce[,sce$cell_labels == "DC"], "exprs")["CD68",])) +
geom_point(aes(CD11c, CD68))
sce$cell_labels[sce$cell_labels == "DC" & (assay(sce, "exprs")["CD11c",] < 2 | assay(sce, "exprs")["CD68",] > 3)] <- "unlabelled"
ggplot(data.frame(CD11c = assay(sce[,sce$cell_labels == "DC"], "exprs")["CD11c",],
CD68 = assay(sce[,sce$cell_labels == "DC"], "exprs")["CD68",])) +
geom_point(aes(CD11c, CD68))
ggplot(data.frame(CD11c = assay(sce_new[,sce_new$cell_labels == "DC"], "exprs")["CD11c",],
CD68 = assay(sce_new[,sce_new$cell_labels == "DC"], "exprs")["CD68",])) +
geom_point(aes(CD11c, CD68))
sce_new$cell_labels[sce_new$cell_labels == "DC" & (assay(sce_new, "exprs")["CD11c",] < 2 | assay(sce_new, "exprs")["CD68",] > 3)] <- "unlabelled"
ggplot(data.frame(CD11c = assay(sce_new[,sce_new$cell_labels == "DC"], "exprs")["CD11c",],
CD68 = assay(sce_new[,sce_new$cell_labels == "DC"], "exprs")["CD68",])) +
geom_point(aes(CD11c, CD68))
lab_sce <- sce[,sce$cell_labels != "unlabelled"]
unlab_sce <- sce[,sce$cell_labels == "unlabelled"]
lab_sce_new <- sce_new[,sce_new$cell_labels != "unlabelled"]
unlab_sce_new <- sce_new[,sce_new$cell_labels == "unlabelled"]
table(lab_sce$cell_labels)
table(lab_sce_new$cell_labels)
set.seed(221107)
trainIndex <- groupKFold(group = factor(lab_sce$sample_id), k = 5)
train_sce <- lab_sce[,trainIndex$Fold1]
test_sce <- lab_sce[,-trainIndex$Fold1]
table(train_sce$cell_labels)
table(test_sce$cell_labels)
set.seed(230410)
trainIndex_new <- groupKFold(group = factor(lab_sce_new$sample_id), k = 5)
train_sce_new <- lab_sce_new[,trainIndex_new$Fold1]
test_sce_new <- lab_sce_new[,-trainIndex_new$Fold1]
table(train_sce_new$cell_labels)
table(test_sce_new$cell_labels)
cur_names <- Reduce(intersect, x = list(colnames(colData(train_sce)), colnames(colData(train_sce_new))))
colData(train_sce) <- colData(train_sce)[,cur_names]
colData(test_sce) <- colData(test_sce)[,cur_names]
colData(train_sce_new) <- colData(train_sce_new)[,cur_names]
colData(test_sce_new) <- colData(test_sce_new)[,cur_names]
reducedDims(train_sce) <- NULL
reducedDims(test_sce) <- NULL
reducedDims(train_sce_new) <- NULL
reducedDims(test_sce_new) <- NULL
train_sce$classifier <- "v1"
test_sce$classifier <- "v1"
train_sce_new$classifier <- "v3"
test_sce_new$classifier <- "v3"
final_train <- cbind(train_sce, train_sce_new)
final_test <- cbind(test_sce, test_sce_new)
table(final_train$cell_labels, final_train$classifier)
table(final_test$cell_labels, final_test$classifier)
rffit <- readRDS("O:/projects/immucan/processed_data/Panel_1/classification/raw/data/rf_images_DCfix.rds")
ggplot(rffit) +
geom_errorbar(data = rffit$results,
aes(ymin = Accuracy - AccuracySD,
ymax = Accuracy + AccuracySD),
width = 0.4)
confusionMatrix(rffit)
cur_varImp <- varImp(rffit)
plot(cur_varImp)
# Add dummy variables
cur_sce <- final_test[,final_test$classifier == "v1"]
cur_mat <- t(assay(cur_sce, "exprs")[!grepl("DNA|Histone", rownames(cur_sce)),])
dummies <- dummyVars(SampleId ~ Indication, data = colData(cur_sce))
all_dummies <- predict(dummies, newdata = colData(cur_sce))
cur_mat <- cbind(cur_mat, all_dummies)
cur_pred <- predict(rffit,
newdata = cur_mat)
cm <- confusionMatrix(data = cur_pred, reference = factor(cur_sce$cell_labels), mode = "everything")
cm
data.frame(cm$byClass) %>%
mutate(class = sub("Class: ", "", rownames(cm$byClass))) %>%
ggplot() +
geom_point(aes(1 - Specificity, Sensitivity,
size = Detection.Rate,
fill = class),
shape = 21) +
scale_fill_manual(values = metadata(sce)$colour_vectors$cell_types) +
theme_bw() +
ylab("Sensitivity (TPR)") +
xlab("1 - Specificity (FPR)")
cur_pred <- predict(rffit,
newdata = cur_mat,
type = "prob")
cur_pred$truth <- factor(cur_sce$cell_labels)
cur_pred %>%
pivot_longer(cols = B:Tumor) %>%
ggplot() +
geom_boxplot(aes(x = name, y = value, fill = name), outlier.size = 0.5) +
facet_wrap(. ~ truth) +
scale_fill_manual(values = metadata(sce)$colour_vectors$cell_types) +
theme(panel.background = element_blank(),
axis.text.x = element_text(angle = 45, hjust = 1))
# Add dummy variables
cur_sce <- final_test[,final_test$classifier == "v3"]
cur_mat <- t(assay(cur_sce, "exprs")[!grepl("DNA|Histone", rownames(cur_sce)),])
dummies <- dummyVars(SampleId ~ Indication, data = colData(cur_sce))
all_dummies <- predict(dummies, newdata = colData(cur_sce))
all_dummies <- cbind(all_dummies, matrix(0, nrow = nrow(all_dummies), dimnames = list(rownames(all_dummies), "IndicationGI")))
cur_mat <- cbind(cur_mat, all_dummies)
cur_pred <- predict(rffit,
newdata = cur_mat)
cur_ref <- factor(cur_sce$cell_labels, levels = levels(cur_pred))
cm <- confusionMatrix(data = cur_pred, reference = cur_ref, mode = "everything")
cm
data.frame(cm$byClass) %>%
mutate(class = sub("Class: ", "", rownames(cm$byClass))) %>%
ggplot() +
geom_point(aes(1 - Specificity, Sensitivity,
size = Detection.Rate,
fill = class),
shape = 21) +
scale_fill_manual(values = metadata(sce)$colour_vectors$cell_types) +
theme_bw() +
ylab("Sensitivity (TPR)") +
xlab("1 - Specificity (FPR)")
cur_pred <- predict(rffit,
newdata = cur_mat,
type = "prob")
cur_pred$truth <- factor(cur_sce$cell_labels)
cur_pred %>%
pivot_longer(cols = B:Tumor) %>%
ggplot() +
geom_boxplot(aes(x = name, y = value, fill = name), outlier.size = 0.5) +
facet_wrap(. ~ truth) +
scale_fill_manual(values = metadata(sce)$colour_vectors$cell_types) +
theme(panel.background = element_blank(),
axis.text.x = element_text(angle = 45, hjust = 1))
# Add dummy variables
cur_sce <- final_test
cur_mat <- t(assay(cur_sce, "exprs")[!grepl("DNA|Histone", rownames(cur_sce)),])
dummies <- dummyVars(SampleId ~ Indication, data = colData(cur_sce))
all_dummies <- predict(dummies, newdata = colData(cur_sce))
all_dummies <- cbind(all_dummies, matrix(0, nrow = nrow(all_dummies), dimnames = list(rownames(all_dummies), "IndicationGI")))
cur_mat <- cbind(cur_mat, all_dummies)
cur_pred <- predict(rffit,
newdata = cur_mat)
cur_ref <- factor(cur_sce$cell_labels, levels = levels(cur_pred))
cm <- confusionMatrix(data = cur_pred, reference = cur_ref, mode = "everything")
cm
data.frame(cm$byClass) %>%
mutate(class = sub("Class: ", "", rownames(cm$byClass))) %>%
ggplot() +
geom_point(aes(1 - Specificity, Sensitivity,
size = Detection.Rate,
fill = class),
shape = 21) +
scale_fill_manual(values = metadata(sce)$colour_vectors$cell_types) +
theme_bw() +
ylab("Sensitivity (TPR)") +
xlab("1 - Specificity (FPR)")
cur_pred <- predict(rffit,
newdata = cur_mat,
type = "prob")
cur_pred$truth <- factor(cur_sce$cell_labels)
cur_pred %>%
pivot_longer(cols = B:Tumor) %>%
ggplot() +
geom_boxplot(aes(x = name, y = value, fill = name), outlier.size = 0.5) +
facet_wrap(. ~ truth) +
scale_fill_manual(values = metadata(sce)$colour_vectors$cell_types) +
theme(panel.background = element_blank(),
axis.text.x = element_text(angle = 45, hjust = 1))
validation <- readRDS("O:/immucan/processed_data/Panel_1/2022_WORKFLOW/IMC/Rout/sce.rds")
validation <- readRDS("O:/projects/immucan/processed_data/Panel_1/2022_WORKFLOW/IMC/Rout/sce.rds")
# Add dummy variables
cur_mat <- t(assay(validation, "exprs")[!grepl("DNA|Histone", rownames(validation)),])
dummies <- dummyVars(sample_id ~ Indication, data = colData(validation))
all_dummies <- predict(dummies, newdata = colData(validation))
cur_mat <- cbind(cur_mat, all_dummies)
cur_pred <- predict(rffit,
newdata = cur_mat)
cur_ref <- validation$celltype
cur_ref[cur_ref == "Bcell"] <- "B"
cur_ref[cur_ref == "Plasma"] <- "plasma"
cur_ref[cur_ref == "BnTcell"] <- "BnT"
cur_pred <- factor(cur_pred, levels = unique(cur_ref))
cm <- confusionMatrix(data = cur_pred, reference = factor(cur_ref, levels = unique(cur_ref)), mode = "everything")
cm
data.frame(cm$byClass) %>%
mutate(class = sub("Class: ", "", rownames(cm$byClass))) %>%
ggplot() +
geom_point(aes(1 - Specificity, Sensitivity,
size = Detection.Rate,
fill = class),
shape = 21) +
scale_fill_manual(values = metadata(sce)$colour_vectors$cell_types) +
ylim(c(0.7, 1)) +
theme_bw() +
ylab("Sensitivity (TPR)") +
xlab("1 - Specificity (FPR)")
# Add dummy variables
cur_sce <- final_test
cur_mat <- t(assay(cur_sce, "exprs")[!grepl("DNA|Histone", rownames(cur_sce)),])
dummies <- dummyVars(SampleId ~ Indication, data = colData(cur_sce))
all_dummies <- predict(dummies, newdata = colData(cur_sce))
all_dummies <- cbind(all_dummies, matrix(0, nrow = nrow(all_dummies), dimnames = list(rownames(all_dummies), "IndicationGI")))
cur_mat <- cbind(cur_mat, all_dummies)
cur_pred <- predict(rffit,
newdata = cur_mat)
cur_ref <- factor(cur_sce$cell_labels, levels = levels(cur_pred))
cm <- confusionMatrix(data = cur_pred, reference = cur_ref, mode = "everything")
cm
pdf(file ="../output/Figure_S4/Fig_4A.pdf")
data.frame(cm$byClass) %>%
mutate(class = sub("Class: ", "", rownames(cm$byClass))) %>%
ggplot() +
geom_point(aes(1 - Specificity, Sensitivity,
size = Detection.Rate,
fill = class),
shape = 21) +
scale_fill_manual(values = metadata(sce)$colour_vectors$cell_types) +
theme_bw() +
ylab("Sensitivity (TPR)") +
xlab("1 - Specificity (FPR)")
dev.off()
pdf(file ="../output/Figure_S4/Fig_4A.pdf", width = 6,height = 4)
data.frame(cm$byClass) %>%
mutate(class = sub("Class: ", "", rownames(cm$byClass))) %>%
ggplot() +
geom_point(aes(1 - Specificity, Sensitivity,
size = Detection.Rate,
fill = class),
shape = 21) +
scale_fill_manual(values = metadata(sce)$colour_vectors$cell_types) +
theme_bw() +
ylab("Sensitivity (TPR)") +
xlab("1 - Specificity (FPR)")
dev.off()
pdf(file ="../output/Figure_S4/Fig_4A.pdf", width = 7,height = 5)
data.frame(cm$byClass) %>%
mutate(class = sub("Class: ", "", rownames(cm$byClass))) %>%
ggplot() +
geom_point(aes(1 - Specificity, Sensitivity,
size = Detection.Rate,
fill = class),
shape = 21) +
scale_fill_manual(values = metadata(sce)$colour_vectors$cell_types) +
theme_bw() +
ylab("Sensitivity (TPR)") +
xlab("1 - Specificity (FPR)")
dev.off()
data.frame(cm$byClass) %>%
mutate(class = sub("Class: ", "", rownames(cm$byClass))) %>%
ggplot() +
geom_point(aes(1 - Specificity, Sensitivity,
size = Detection.Rate,
fill = class),
shape = 21) +
scale_fill_manual(values = metadata(sce)$colour_vectors$cell_types) +
theme_bw() +
scale_size(range = c(1,6))+
ylab("Sensitivity (TPR)") +
xlab("1 - Specificity (FPR)")
data.frame(cm$byClass) %>%
mutate(class = sub("Class: ", "", rownames(cm$byClass))) %>%
ggplot() +
geom_point(aes(1 - Specificity, Sensitivity,
size = Detection.Rate,
fill = class),
shape = 21) +
scale_fill_manual(values = metadata(sce)$colour_vectors$cell_types) +
theme_bw() +
scale_size(range = c(1,10))+
ylab("Sensitivity (TPR)") +
xlab("1 - Specificity (FPR)")
data.frame(cm$byClass) %>%
mutate(class = sub("Class: ", "", rownames(cm$byClass))) %>%
ggplot() +
geom_point(aes(1 - Specificity, Sensitivity,
size = Detection.Rate,
fill = class),
shape = 21) +
scale_fill_manual(values = metadata(sce)$colour_vectors$cell_types) +
theme_bw() +
scale_size(range = c(20))+
ylab("Sensitivity (TPR)") +
xlab("1 - Specificity (FPR)")
data.frame(cm$byClass) %>%
mutate(class = sub("Class: ", "", rownames(cm$byClass))) %>%
ggplot() +
geom_point(aes(1 - Specificity, Sensitivity,
size = Detection.Rate,
fill = class),
shape = 21) +
scale_fill_manual(values = metadata(sce)$colour_vectors$cell_types) +
theme_bw() +
scale_size(range = c(1,120))+
ylab("Sensitivity (TPR)") +
xlab("1 - Specificity (FPR)")
data.frame(cm$byClass) %>%
mutate(class = sub("Class: ", "", rownames(cm$byClass))) %>%
ggplot() +
geom_point(aes(1 - Specificity, Sensitivity,
size = Detection.Rate,
fill = class),
shape = 21) +
scale_fill_manual(values = metadata(sce)$colour_vectors$cell_types) +
theme_bw() +
scale_size(range = c(1,20))+
ylab("Sensitivity (TPR)") +
xlab("1 - Specificity (FPR)")
data.frame(cm$byClass) %>%
mutate(class = sub("Class: ", "", rownames(cm$byClass))) %>%
ggplot() +
geom_point(aes(1 - Specificity, Sensitivity,
size = Detection.Rate,
fill = class),
shape = 21) +
scale_fill_manual(values = metadata(sce)$colour_vectors$cell_types) +
theme_bw() +
scale_size(range = c(1,10))+
ylab("Sensitivity (TPR)") +
xlab("1 - Specificity (FPR)")
pdf(file ="../output/Figure_S4/Fig_4A.pdf", width = 7,height = 5)
data.frame(cm$byClass) %>%
mutate(class = sub("Class: ", "", rownames(cm$byClass))) %>%
ggplot() +
geom_point(aes(1 - Specificity, Sensitivity,
size = Detection.Rate,
fill = class),
shape = 21) +
scale_fill_manual(values = metadata(sce)$colour_vectors$cell_types) +
theme_bw() +
scale_size(range = c(1,10))+
ylab("Sensitivity (TPR)") +
xlab("1 - Specificity (FPR)")
dev.off()
cur_pred <- predict(rffit,
newdata = cur_mat,
type = "prob")
cur_pred$truth <- factor(cur_sce$cell_labels)
cur_pred %>%
pivot_longer(cols = B:Tumor) %>%
ggplot() +
geom_boxplot(aes(x = name, y = value, fill = name), outlier.size = 0.5) +
facet_wrap(. ~ truth) +
scale_fill_manual(values = metadata(sce)$colour_vectors$cell_types) +
theme(panel.background = element_blank(),
axis.text.x = element_text(angle = 45, hjust = 1))
cur_pred <- predict(rffit,
newdata = cur_mat,
type = "prob")
cur_pred$truth <- factor(cur_sce$cell_labels)
cur_pred %>%
pivot_longer(cols = B:Tumor) %>%
ggplot() +
geom_boxplot(aes(x = name, y = value, fill = name), outlier.size = 0.5) +
facet_wrap(. ~ truth) +
scale_fill_manual(values = metadata(sce)$colour_vectors$cell_types) +
theme(panel.background = element_blank(),
axis.text.x = element_text(angle = 45, hjust = 1))
m_boxplot(aes(x = name, y = value, fill = name), outlier.size = 0.5) +
facet_wrap(. ~ truth) +
scale_fill_manual(values = metadata(sce)$colour_vectors$cell_types) +
theme(panel.background = element_blank(),
axis.text.x = element_text(angle = 45, hjust = 1))
cur_pred %>%
pivot_longer(cols = B:Tumor) %>%
ggplot() +
geom_boxplot(aes(x = name, y = value, fill = name), outlier.size = 0.5) +
facet_wrap(. ~ truth) +
scale_fill_manual(values = metadata(sce)$colour_vectors$cell_types) +
theme(panel.background = element_blank(),
axis.text.x = element_text(angle = 45, hjust = 1))
png(file ="../output/Figure_S4/Fig_4B.png", width = 7,height = 12,units = "cm")
?png
png(file ="../output/Figure_S4/Fig_4B.png", width = 7,height = 12,units = "cm", res = 300)
cur_pred %>%
pivot_longer(cols = B:Tumor) %>%
ggplot() +
geom_boxplot(aes(x = name, y = value, fill = name), outlier.size = 0.5) +
facet_wrap(. ~ truth) +
scale_fill_manual(values = metadata(sce)$colour_vectors$cell_types) +
theme(panel.background = element_blank(),
axis.text.x = element_text(angle = 45, hjust = 1))
dev.off()
png(file ="../output/Figure_S4/Fig_4B.png", width = 20,height = 10,units = "cm", res = 300)
cur_pred %>%
pivot_longer(cols = B:Tumor) %>%
ggplot() +
geom_boxplot(aes(x = name, y = value, fill = name), outlier.size = 0.5) +
facet_wrap(. ~ truth) +
scale_fill_manual(values = metadata(sce)$colour_vectors$cell_types) +
theme(panel.background = element_blank(),
axis.text.x = element_text(angle = 45, hjust = 1))
dev.off()
png(file ="../output/Figure_S4/Fig_4B.png", width = 24,height = 14,units = "cm", res = 300)
cur_pred %>%
pivot_longer(cols = B:Tumor) %>%
ggplot() +
geom_boxplot(aes(x = name, y = value, fill = name), outlier.size = 0.5) +
facet_wrap(. ~ truth) +
scale_fill_manual(values = metadata(sce)$colour_vectors$cell_types) +
theme(panel.background = element_blank(),
axis.text.x = element_text(angle = 45, hjust = 1))
dev.off()
data.frame(cm$byClass) %>%
mutate(class = sub("Class: ", "", rownames(cm$byClass))) %>%
ggplot() +
geom_point(aes(1 - Specificity, Sensitivity,
size = Detection.Rate,
fill = class),
shape = 21) +
scale_fill_manual(values = metadata(sce)$colour_vectors$cell_types) +
theme_bw() +
scale_size(range = c(1,10))+
ylab("Sensitivity (TPR)") +
xlab("1 - Specificity (FPR)")
pdf(file ="../output/Figure_S4/Fig_4A.pdf", width = 8,height = 6)
data.frame(cm$byClass) %>%
mutate(class = sub("Class: ", "", rownames(cm$byClass))) %>%
ggplot() +
geom_point(aes(1 - Specificity, Sensitivity,
size = Detection.Rate,
fill = class),
shape = 21) +
scale_fill_manual(values = metadata(sce)$colour_vectors$cell_types) +
theme_bw() +
scale_size(range = c(1,10))+
ylab("Sensitivity (TPR)") +
xlab("1 - Specificity (FPR)")
dev.off()
pdf(file ="../output/Figure_S4/Fig_4A.pdf", width = 8,height = 6)
data.frame(cm$byClass) %>%
mutate(class = sub("Class: ", "", rownames(cm$byClass))) %>%
ggplot() +
geom_point(aes(1 - Specificity, Sensitivity,
size = Detection.Rate,
fill = class),
shape = 21) +
scale_fill_manual(values = metadata(sce)$colour_vectors$cell_types) +
theme_bw() +
scale_size(range = c(1,12))+
ylab("Sensitivity (TPR)") +
xlab("1 - Specificity (FPR)")
dev.off()
png(file ="../output/Figure_S4/Fig_4B.png", width = 35,height = 22,units = "cm", res = 300)
cur_pred %>%
pivot_longer(cols = B:Tumor) %>%
ggplot() +
geom_boxplot(aes(x = name, y = value, fill = name), outlier.size = 0.5) +
facet_wrap(. ~ truth) +
scale_fill_manual(values = metadata(sce)$colour_vectors$cell_types) +
theme(panel.background = element_blank(),
axis.text.x = element_text(angle = 45, hjust = 1))
dev.off()
png(file ="../output/Figure_S4/Fig_4B.png", width = 35,height = 22,units = "cm", res = 600)
cur_pred %>%
pivot_longer(cols = B:Tumor) %>%
ggplot() +
geom_boxplot(aes(x = name, y = value, fill = name), outlier.size = 0.5) +
facet_wrap(. ~ truth) +
scale_fill_manual(values = metadata(sce)$colour_vectors$cell_types) +
theme(panel.background = element_blank(),
axis.text.x = element_text(angle = 45, hjust = 1))
dev.off()
cur_pred %>%
pivot_longer(cols = B:Tumor) %>%
ggplot() +
geom_boxplot(aes(x = name, y = value, fill = name), outlier.size = 0.5) +
facet_wrap(. ~ truth) +
scale_fill_manual(values = metadata(sce)$colour_vectors$cell_types) +
theme(panel.background = element_blank(),
axis.text.x = element_text(angle = 45, hjust = 1))+
ylab("max probability")+
xlab("cell type")
cur_pred %>%
pivot_longer(cols = B:Tumor)
png(file ="../output/Figure_S4/Fig_4B.png", width = 35,height = 22,units = "cm", res = 300)
cur_pred %>%
pivot_longer(cols = B:Tumor) %>%
ggplot() +
geom_boxplot(aes(x = name, y = value, fill = name), outlier.size = 0.5) +
facet_wrap(. ~ truth) +
scale_fill_manual(values = metadata(sce)$colour_vectors$cell_types) +
theme(panel.background = element_blank(),
axis.text.x = element_text(angle = 45, hjust = 1))+
ylab("max probability")+
xlab("cell type")
dev.off()
png(file ="../output/Figure_S4/Fig_4B.png", width = 35,height = 22,units = "cm", res = 1200)
cur_pred %>%
pivot_longer(cols = B:Tumor) %>%
ggplot() +
geom_boxplot(aes(x = name, y = value, fill = name), outlier.size = 0.5) +
facet_wrap(. ~ truth) +
scale_fill_manual(values = metadata(sce)$colour_vectors$cell_types) +
theme(panel.background = element_blank(),
axis.text.x = element_text(angle = 45, hjust = 1))+
ylab("max probability")+
xlab("cell type")
dev.off()
png(file ="../output/Figure_S4/Fig_4B.png", width = 35,height = 22,units = "cm", res = 1200)
cur_pred %>%
pivot_longer(cols = B:Tumor) %>%
ggplot() +
geom_boxplot(aes(x = name, y = value, fill = name), outlier.size = 0.5) +
facet_wrap(. ~ truth) +
scale_fill_manual(values = metadata(sce)$colour_vectors$cell_types) +
theme(panel.background = element_blank(),
axis.text.x = element_text(angle = 45, hjust = 1))+
ylab("probability")+
xlab("cell type")
dev.off()
